


## 刷题
### TCP
![[Pasted image 20240430215500.png]]
TCP段头中的校验和字段（隐式或显式）与TCP提供的以下哪项服务相关联？无需解释。 A. 流量控制 B. 多路复用/解复用 C. 无 D. 拥塞控制 E. 可靠的按序字节流传输

正确答案是 E. 可靠的按序字节流传输。

校验和字段在TCP头部主要用于确保数据的完整性，帮助实现可靠的数据传输。通过校验接收到的数据段的校验和，可以检测在传输过程中是否发生了错误，从而保证数据的正确性和可靠性。

```ad-note
A. **流量控制（Flow Control）**  
流量控制是TCP协议中用来确保发送方不会因为发送数据过快而超出接收方的处理能力。这通过使用窗口大小（window size）来实现，窗口大小告诉发送方接收方还能接收多少数据。这个过程帮助避免接收方缓冲区溢出，确保数据的顺利接收。

B. **多路复用/解复用（Multiplexing/Demultiplexing）**  
多路复用和解复用是网络中的一种技术，允许多个数据流在单一的物理媒体上共享，而不会相互干扰。在TCP/IP模型中，这主要通过使用端口号来实现。每个TCP段都有源端口和目标端口号，它们允许操作系统区分并正确地将数据发送到应用程序。

D. **拥塞控制（Congestion Control）**  
拥塞控制是一种网络机制，旨在防止过多的数据注入到网络中，这可能会导致网络负载过重，从而降低数据传输效率。TCP使用一系列的算法（如慢启动、拥塞避免、快速恢复和快速重传）来控制数据的发送速率，以应对网络中的拥塞状况。

```
![[Pasted image 20240430221201.png]]
- a:59500
- b:334
```ad-attention
题目中说是a secure web server
假设它使用的是标准的安全Web服务端口，通常为HTTPS连接的443端口
而通常的HTTP为80端口

```

- c：12500，题目要读清楚是谁给谁的数据段
- d：6201，只有传输了数据，seq才会变化
- e：5500，题目说明客户端一次不能接收超过5500字节，因此接收窗口大小是5500
- f：题目指出没有使用选项字段。TCP头部的基本长度是20字节，如果没有选项，头部长度就是20字节。
[小谈TCP协议中的ACK和SEQ号 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/439614017)
关于拥塞控制
![[Pasted image 20240430233614.png]]
## IP分片
![[Pasted image 20240430234038.png]]
题目中要求ISP（互联网服务提供商）对一系列的IP地址块进行聚合，然后广播这个聚合后的地址块以用于路由。这些IP地址块如下：
SP应该广播的聚合IP地址块是 **192.168.10.0/26**。这个地址块足以覆盖原来的5个/29地址块，同时优化了路由表的大小和管理
![[Pasted image 20240430235219.png]]
  
题目要求处理一个3220字节长的IP数据报，该数据报没有选项字段。由于其长度超过了以太网的最大传输单元（MTU）1500字节，因此需要在路由器上进行分片处理。
### 题目a部分

假设路由器将该数据报分成3个片段，且尽可能地使用最大的片段大小。对于以太网，MTU是1500字节，但考虑到每个IP数据报片段都需要有自己的IP头部（通常为20字节），有效载荷的最大大小应该是1480字节（1500 - 20 = 1480）。

我们需要决定每个片段的大小和片段的起始字节和结束字节，并计算每个片段的片段偏移。

**分片详细信息**：

1. **第一个片段**：
    
    - **片段大小**：1480字节（最大载荷）
    - **起始字节**：0
    - **结束字节**：1479
    - **片段偏移**：0 / 8 = 0（片段偏移以8字节为单位）
2. **第二个片段**：
    
    - **片段大小**：1480字节
    - **起始字节**：1480
    - **结束字节**：2959
    - **片段偏移**：1480 / 8 = 185（片段偏移以8字节为单位）
3. **第三个片段**：
    
    - **片段大小**：3220 - 2960 = 260字节（剩余的数据长度）
    - **起始字节**：2960
    - **结束字节**：3219
    - **片段偏移**：2960 / 8 = 370（片段偏移以8字节为单位）

### 题目b部分

总共的字节数量包括了所有IP头部。由于每个片段都需要一个新的IP头部，每个IP头部占用20字节。

- **总IP头部字节数**：3 * 20 = 60字节
- **总片段字节数**：1480 + 1480 + 260 = 3220字节

因此，离开路由器的所有片段的累计字节数为3220（数据） + 60（IP头部） = 3280字节。

这意味着离开路由器的数据比原始数据报多了60字节，原因在于每个片段都必须有自己的IP头部。这些额外的字节是由于必须对每个片段重新加上新的IP头部所需的额外信息造成的。
## 内外网+NAT
![[Pasted image 20240430235855.png]]![[Pasted image 20240430235953.png]]
### 第一部分

**在Eth1接口捕获从PC1发往服务器的请求**：

- **源 IP 地址**：在Eth1接口捕获，显示的是NAT之后的地址，因此源IP地址为 `195.12.15.20`。
    
- **目的 IP 地址**：服务器的公共IP地址，`200.10.30.40`。
    
- **源端口号**：由NAT分配给PC1的公网端口号。为简单起见，假设是 `50000`。
    

- **目的端口号**：请求Web服务通常使用HTTP，默认端口为 `80`。

### 第二部分

**在Eth0接口捕获从服务器到PC1的响应**：

- **源 IP 地址**：服务器的响应发起自服务器的公共IP地址，即 `200.10.30.40`。
    
- **目的 IP 地址**：响应目标为PC1，但因为报文在Eth0接口捕获，此时已经通过NAT转换回PC1的私有IP地址，所以目的IP地址是 `192.168.5.2`。
    
- **源端口号**：服务器发送响应的端口，使用HTTP服务的端口 `80`。
    
- **目的端口号**：由于是HTTP响应，目标端口应是PC1最初用来发起请求的端口，这在NAT设备上转换过。根据之前假设，这个端口是 `50000`
### 第一部分：在Eth1捕获从PC1发往服务器的请求

#### MAC 地址

- **源 MAC 地址**：
    - 数据包将从路由器的Eth1接口发送到外部网络。因此，源MAC地址将是路由器Eth1接口的MAC地址。
- **目的 MAC 地址**：
    - 目的MAC地址取决于数据包需要经过的下一个网络设备。如果路由器Eth1接口直接连接到某个上层路由器或者交换机，那么目的MAC地址将是那个设备接口的MAC地址。

### 第二部分：在Eth0捕获从服务器到PC1的响应

#### MAC 地址

- **源 MAC 地址**：
    - 由于数据包是从路由器的外部接口Eth1转发到内部接口Eth0，源MAC地址将是路由器Eth1接口的MAC地址。
- **目的 MAC 地址**：
    - 目的MAC地址会是PC1的网络接口卡的MAC地址，因为数据包是直接发送到PC1。

### 综合说明

在实际网络操作中，MAC地址的决定基于局域网内的设备物理位置和连接。当数据包到达路由器或交换机时，这些设备会根据自己的ARP表（地址解析协议表）来确定下一跳设备的MAC地址。ARP表中记录了IP地址与MAC地址的映射。如果目标IP地址在当前子网中，则直接使用对应的MAC地址；如果不在，则使用默认网关的MAC地址。

## IP地址
![[Pasted image 20240501001411.png]]
### 1. 计算地址块中的地址总数

子网掩码是/25，这意味着前25位是网络部分，后7位是主机部分（因为32-25=7）。主机部分的位数可以提供的地址数为 27=12827=128 个地址。

### 2. 网络地址

网络地址是将IP地址中的主机部分设置为0的地址。对于191.56.125.34/25，网络部分的最后一位是第25位，因此我们需要将第25位及之后的所有位设置为0。

- 原始IP地址：191.56.125.34 的二进制形式为：10111111.00111000.01111101.00100010
- 网络地址：将最后7位设为0，得到10111111.00111000.01111101.00000000，即191.56.125.0

因此，网络地址是 191.56.125.0/25。

### 3. 广播地址

广播地址是将IP地址中的主机部分设置为1的地址。对于191.56.125.34/25，我们将主机部分的每一位都设置为1。

- 广播地址：将最后7位设为1，得到10111111.00111000.01111101.01111111，即191.56.125.127

因此，广播地址是 191.56.125.127/25。

### 4. 可用的主机地址范围

可用的主机地址是网络地址和广播地址之间的地址，但不包括这两个地址本身。

- 开始地址：网络地址之后的第一个地址，191.56.125.1
- 结束地址：广播地址之前的最后一个地址，191.56.125.126

因此，可用的主机地址范围是从 191.56.125.1 到 191.56.125.126。

### 汇总回答：

- **地址总数**：128
- **网络地址**：191.56.125.0/25
- **广播地址**：191.56.125.127/25
- **可用主机地址范围**：从 191.56.125.1 到 191.56.125.126
